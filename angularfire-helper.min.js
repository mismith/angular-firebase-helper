angular.module("firebaseHelper",["firebase"]).provider("$firebaseHelper",function(){var e="",r=!1,n={};this.namespace=function(r){return void 0!==r&&(e=r),e},this.demo=function(e){return void 0!==e&&(r=e),r};var t=this.url=function(){if(!e)throw new Error("Firebase namespace not set, configure $firebaseHelperProvider.namespace('my-app') before using $firebaseHelper.");return"https://"+e+".firebaseio"+(r?"-demo":"")+".com/"},a=function(e){return e.replace(/^\/+/,"")};this.$get=["$firebase","$firebaseAuth","$q",function(e,r,i){var s=this,u=s.$get=["input","as",function(r,i){var s,o=i;if(angular.isString(r))s=e(new Firebase(t()+a(r)));else if(angular.isArray(r)){if(r.length)if(angular.isString(r[0]))s=e(new Firebase(t()+a(r.join("/"))));else{var c=r.shift(),l=u(c,"ref");l=l.child(a(r.join("/"))),s=e(l)}}else angular.isObject(r)&&(angular.isFunction(r.$inst)?s=r.$inst():angular.isFunction(r.$ref)?s=r:angular.isFunction(r.child)&&(s=e(r)));if(s||(s=e(new Firebase(t()))),o+=s.$ref().path.toString(),n[o])return n[o];switch(i){case"ref":return n[o]=s.$ref();default:case"inst":return n[o]=s;case"object":return n[o]=s.$asObject();case"array":return n[o]=s.$asArray()}}];return s.auth=function(){return r(u(Array.prototype.slice.call(arguments),"ref"))},s.ref=function(){return u(Array.prototype.slice.call(arguments),"ref")},s.inst=function(){return u(Array.prototype.slice.call(arguments),"inst")},s.object=function(){var e=Array.prototype.slice.call(arguments),r="object";return e[e.length-1]===!0&&(r="array",e.pop()),u(e,r)},s.array=function(){var e=Array.prototype.slice.call(arguments);return e.push(!0),s.object.apply(this,e)},s.load=function(){return s.object.apply(this,arguments).$loaded()},s.populate=function(e,r,n,t){var a=[],s=u(e,"ref");return keysLength=0,s.once("value",function(e){angular.isObject(e.val())||(angular.isFunction(n)&&n(),angular.isFunction(t)&&t())}),s.on("child_added",function(e){var s=u([r,e.key()],"object");keysLength++,s.$loaded().then(function(){var e=[];angular.isFunction(n)&&e.push(n(s)),i.all(e).then(function(){a.push(s),a.length==keysLength&&angular.isFunction(t)&&t(a)})})}),s.on("child_removed",function(e){var r=-1,n=e.key();keysLength--,angular.forEach(a,function(e,t){r>=0||e.$id==n&&(r=t)}),r>=0&&a.splice(r,1)}),a},s.intersect=function(r,n,t,a){if(!Firebase.util)throw new Error("$firebaseHelper.intersect() requires the `Firebase.util` external library. See: https://github.com/firebase/firebase-util");var i={ref:s.ref(r)},u={ref:s.ref(n)};return t&&(i.keyMap=t),a&&(u.keyMap=a),e(Firebase.util.intersection(i,u)).$asArray()},s}]});