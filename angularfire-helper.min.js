angular.module("firebaseHelper",["firebase"]).provider("$firebaseHelper",function(){var e="",r=!1,n={};this.namespace=function(r){return void 0!==r&&(e=r),e},this.demo=function(e){return void 0!==e&&(r=e),r};var t=this.url=function(){if(!e)throw new Error("Firebase namespace not set, configure $firebaseHelperProvider.namespace('my-app') before using $firebaseHelper.");return"https://"+e+".firebaseio"+(r?"-demo":"")+".com/"},i=function(e){return e.replace(/^\/+/,"")};this.$get=["$firebase","$firebaseAuth","$q",function(e,r,a){var u=this,s=u.$get=["input","as",function(r,a){var u,o=a;if(angular.isString(r))u=e(new Firebase(t()+i(r)));else if(angular.isObject(r))if(angular.isFunction(r.$inst))u=r.$inst();else if(angular.isFunction(r.$ref))u=r;else if(angular.isFunction(r.child))u=e(r);else if(angular.isArray(r)&&r.length)if(angular.isString(r[0]))u=e(new Firebase(t()+i(r.join("/"))));else{var c=r.shift(),l=s(c,"ref");l=l.child(i(r.join("/"))),u=e(l)}if(u||(u=e(new Firebase(t()))),o+=u.$ref().path.toString(),n[o])return n[o];switch(a){case"ref":return n[o]=u.$ref();default:case"inst":return n[o]=u;case"object":return n[o]=u.$asObject();case"array":return n[o]=u.$asArray()}}];return u.auth=function(){return r(s(Array.prototype.slice.call(arguments),"ref"))},u.path=function(e){return s(e,"ref").toString().replace(t(),"")},u.ref=function(){return s(Array.prototype.slice.call(arguments),"ref")},u.inst=function(){return s(Array.prototype.slice.call(arguments),"inst")},u.object=function(){var e=Array.prototype.slice.call(arguments),r="object";return e[e.length-1]===!0&&(r="array",e.pop()),s(e,r)},u.array=function(){var e=Array.prototype.slice.call(arguments);return e.push(!0),u.object.apply(this,e)},u.load=function(){return u.object.apply(this,arguments).$loaded()},u.populate=function(e,r,n,t){var i=[],u=s(e,"ref");return function(e){u.once("value",function(e){angular.isObject(e.val())||(angular.isFunction(n)&&n(),angular.isFunction(t)&&t())}),u.on("child_added",function(u){var o=s([r,u.key()],"object");e++,o.$loaded().then(function(){var r=[];angular.isFunction(n)&&r.push(n(o)),a.all(r).then(function(){i.push(o),i.length==e&&angular.isFunction(t)&&t(i)})})}),u.on("child_removed",function(r){var n=-1,t=r.key();e--,angular.forEach(i,function(e,r){n>=0||e.$id==t&&(n=r)}),n>=0&&i.splice(n,1)})}(0),i},u.intersect=function(r,n,t,i){if(!Firebase.util)throw new Error("$firebaseHelper.intersect() requires the `Firebase.util` external library. See: https://github.com/firebase/firebase-util");var a={ref:u.ref(r)},s={ref:u.ref(n)};return t&&(a.keyMap=t),i&&(s.keyMap=i),e(Firebase.util.intersection(a,s)).$asArray()},u}]});